// implement silimarly to filter_main, have parent thread do final few reduces